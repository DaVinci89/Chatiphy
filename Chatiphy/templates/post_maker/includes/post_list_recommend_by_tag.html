{% load post_tags %}
{% load filters %}
<div class="post-list">
    {% for post in similar_posts %}
        <div class="post-list-item">
            <div class="post-list-meta">
                <span class="post-list-date">{{post.pub_date|date:"d E Y"}}</span>
                <span class="post-list-author">by <a href="{% url 'users:profile' post.author %}">{{ post.author }}</a></span>
                {% if post.group %}
                    <span class="post-list-group"><a href="{% url 'post_maker:group_page' post.group.slug %}">{{ post.group }}</a></span>
                {% endif %}
            </div>
            {% if post.title %}
                <h2 class="post-list-title">{{ post.title }}</h2>
            {% endif %}
            {% if post.image %}
                <div class="post-image">
                    <img src="{{ post.image.url }}" alt="{{ post.title }}">
                </div>
            {% endif %}
            <p class="post-excerpt">{{ post.text|markdown|truncatewords_html:30 }}...</p>
            <div class="post-list-meta">
                {% for tag in post.tag.all %}
                    <a class="post-list-tags" href="{% url 'post_maker:index_by_tag' tag.slug %}">{{ tag.name }}</a>
                {% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
            {% with likes_dict|get_item:post.id as liked %}
            <button id="like-btn-{{ post.id }}"
                    class="{% if likes_dict %}active-like{% endif %}"
                    onclick="likeDislikePost({{ post.id }}, true)">Like</button>

            <button id="dislike-btn-{{ post.id }}"
                    class="{% if likes_dict %}active-dislike{% endif %}"
                    onclick="likeDislikePost({{ post.id }}, false)">Dislike</button>
            {% endwith %}

            <p>Likes: <span id="likes-count-{{ post.id }}">{{ post.likes_count }}</span></p>
            <p>Dislikes: <span id="dislikes-count-{{ post.id }}">{{ post.dislikes_count }}</span></p>
            <a href="{{ post.get_absolute_url }}" class="read-more">Read more</a>
        </div>
    {% empty %}
        <p>No similar posts yet</p>
    {% endfor %}
</div>